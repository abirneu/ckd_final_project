{% load static %}
{% include 'base.html' %}
{% include 'navbar.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .password-strength {
            height: 4px;
            transition: all 0.3s ease;
        }
        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen mt-10">
    <div class="container mx-auto px-4 py-12">
        <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl transition-all duration-300 hover:shadow-xl">
            <div class="p-8">
                <div class="flex justify-center mb-8">
                    <div class="bg-gradient-to-r from-blue-500 to-indigo-600 p-3 rounded-full animate-float">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4" />
                        </svg>
                    </div>
                </div>
                
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-2">Create Your Account</h2>
                <p class="text-center text-gray-500 mb-8">Join our community today</p>

                {% if error %}
                <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-red-700">{{ error }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}

                <form method="POST" class="space-y-6" id="registerForm">
                    {% csrf_token %}
                    
                    <div class="space-y-1">
                        <label for="diabetes" class="block text-sm font-medium text-gray-700">Select Role</label>
                        <div class="relative">
                            <select name="diabetes" id="diabetes" class="block w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-gray-50 appearance-none" required>
                                <option value="">Select your role</option>
                                <option value="doctor">Doctor</option>
                                <option value="staff">Staff</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                            <input type="text" id="username" name="username" 
                                   class="mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   required
                                   minlength="3"
                                   pattern="[a-zA-Z0-9]+"
                                   title="Only letters and numbers allowed">
                            {% comment %} <div id="username-feedback" class="text-xs mt-1 text-gray-500"></div> {% endcomment %}
                        </div>

                        <div>
                            <label for="reg" class="block text-sm font-medium text-gray-700">Registration Number</label>
                            <input type="text" id="reg" name="reg" 
                                   class="mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   required>
                            <div id="reg-feedback" class="text-xs mt-1 text-gray-500"></div>
                        </div>
                    </div>

                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="email" name="email" 
                               class="mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                               required>
                        <div id="email-feedback" class="text-xs mt-1 text-gray-500"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                            <div class="relative">
                                <input type="tel" id="phone" name="phone" 
                                       class="mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       required 
                                       pattern="^\+?1?\d{9,15}$" 
                                       title="Enter a valid phone number">
                                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                                    <span class="has-tooltip cursor-help">
                                        <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z" clip-rule="evenodd" />
                                        </svg>
                                        <span class="tooltip absolute z-10 w-48 p-2 mt-2 text-xs text-white bg-gray-800 rounded shadow-lg">
                                            Format: +8801234567890 or 01736695636
                                        </span>
                                    </span>
                                </div>
                            </div>
                            <div id="phone-feedback" class="text-xs mt-1 text-gray-500"></div>
                        </div>

                        <div>
                            <label for="date_of_birth" class="block text-sm font-medium text-gray-700">Date of Birth</label>
                            <input type="date" id="date_of_birth" name="date_of_birth" 
                                   class="mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   required
                                   max="">
                            <div id="dob-feedback" class="text-xs mt-1 text-gray-500"></div>
                        </div>
                    </div>

                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                        <div class="relative">
                            <input type="password" id="password" name="password" 
                                   class="mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                   required 
                                   minlength="8">
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 cursor-pointer" id="togglePassword">
                                <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" id="eyeIcon">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                        <div class="mt-2">
                            <div class="grid grid-cols-4 gap-1 mb-1">
                                <div id="strength-1" class="password-strength bg-gray-200 rounded"></div>
                                <div id="strength-2" class="password-strength bg-gray-200 rounded"></div>
                                <div id="strength-3" class="password-strength bg-gray-200 rounded"></div>
                                <div id="strength-4" class="password-strength bg-gray-200 rounded"></div>
                            </div>
                            <div id="password-feedback" class="text-xs text-gray-500"></div>
                        </div>
                    </div>

                    <div>
                        <label for="address" class="block text-sm font-medium text-gray-700">Address</label>
                        <textarea id="address" name="address" rows="3" 
                                  class="mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                  required></textarea>
                    </div>

                    <div class="flex items-center">
    <input id="terms" name="terms" type="checkbox" 
           class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" required>
    <label for="terms" class="ml-2 block text-sm text-gray-700">
        I agree to the <a href="#" class="text-blue-600 hover:underline" id="termsLink">Terms and Conditions</a>
    </label>
</div>

<!-- Terms and Conditions Modal -->
<div id="termsModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-2/3 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-left">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Terms and Conditions</h3>
            
            <div class="mt-2 max-h-96 overflow-y-auto text-sm text-gray-500 space-y-4">
                <p><strong>Last Updated:</strong> [Current Date]</p>
                
                <h4 class="font-semibold text-gray-800">1. Acceptance of Terms</h4>
                <p>By registering for the CKD Prediction and Test Suggestion System ("the System"), you agree to comply with and be bound by these terms and conditions.</p>
                
                <h4 class="font-semibold text-gray-800">2. System Purpose</h4>
                <p>The System is designed to:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Predict the likelihood of Chronic Kidney Disease based on patient symptoms and medical data</li>
                    <li>Suggest appropriate diagnostic tests based on symptom analysis</li>
                    <li>Provide medical professionals with decision support tools</li>
                </ul>
                
                <h4 class="font-semibold text-gray-800">3. Professional Use Only</h4>
                <p>This System is intended for use by qualified medical professionals only. All predictions and suggestions should be:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Verified by clinical judgment</li>
                    <li>Correlated with complete patient history</li>
                    <li>Confirmed through appropriate diagnostic procedures</li>
                </ul>
                
                <h4 class="font-semibold text-gray-800">4. Data Privacy and HIPAA Compliance</h4>
                <p>All users must:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Maintain patient confidentiality in accordance with HIPAA regulations</li>
                    <li>Only input de-identified patient data when required</li>
                    <li>Secure all login credentials and prevent unauthorized access</li>
                </ul>
                
                <h4 class="font-semibold text-gray-800">5. Limitations of Liability</h4>
                <p>The System provides predictive analytics only and:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Does not replace professional medical judgment</li>
                    <li>Should not be used as the sole basis for diagnosis or treatment</li>
                    <li>Is not responsible for clinical decisions made by users</li>
                </ul>
                
                <h4 class="font-semibold text-gray-800">6. Data Accuracy</h4>
                <p>Users are responsible for:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Inputting accurate and complete patient data</li>
                    <li>Verifying all suggested tests against current medical guidelines</li>
                    <li>Reporting any system inaccuracies to administrators</li>
                </ul>
                
                <h4 class="font-semibold text-gray-800">7. Account Security</h4>
                <p>Registered users must:</p>
                <ul class="list-disc pl-5 space-y-1">
                    <li>Maintain the confidentiality of their login credentials</li>
                    <li>Immediately report any unauthorized account access</li>
                    <li>Not share accounts among multiple individuals</li>
                </ul>
            </div>
            
            <div class="items-center px-4 py-3 mt-4">
                <button id="closeTerms" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300">
                    I Understand
                </button>
            </div>
        </div>
    </div>
</div>



                    <button type="submit" 
                            class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold py-3 px-4 rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200 transform "
                            id="submitBtn">
                        Register Now
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <p class="text-sm text-gray-600">
                        Already have an account? 
                        <a href="{% url 'login' %}" class="font-medium text-blue-600 hover:text-blue-500 hover:underline">Sign in</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
    {% include 'footer.html' %}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set max date for date of birth (must be at least 18 years old)
            const dobInput = document.getElementById('date_of_birth');
            const today = new Date();
            const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
            dobInput.max = maxDate.toISOString().split('T')[0];

            // Password visibility toggle
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('eyeIcon');
            
            togglePassword.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                
                // Toggle eye icon
                if (type === 'text') {
                    eyeIcon.innerHTML = `<path fill-rule="evenodd" d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z" clip-rule="evenodd" /><path d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z" />`;
                } else {
                    eyeIcon.innerHTML = `<path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />`;
                }
            });

            // Password strength meter
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                const strengthBars = [
                    document.getElementById('strength-1'),
                    document.getElementById('strength-2'),
                    document.getElementById('strength-3'),
                    document.getElementById('strength-4')
                ];
                const feedback = document.getElementById('password-feedback');
                
                // Reset all bars
                strengthBars.forEach(bar => {
                    bar.style.backgroundColor = '#e5e7eb'; // gray-200
                });
                
                if (password.length === 0) {
                    feedback.textContent = '';
                    return;
                }
                
                // Very weak (just length)
                if (password.length < 8) {
                    strengthBars[0].style.backgroundColor = '#ef4444'; // red-500
                    feedback.textContent = 'Password is too short (min 8 characters)';
                    feedback.className = 'text-xs text-red-500';
                    return;
                }
                
                // Check complexity
                let strength = 0;
                const hasLower = /[a-z]/.test(password);
                const hasUpper = /[A-Z]/.test(password);
                const hasNumber = /[0-9]/.test(password);
                const hasSpecial = /[^a-zA-Z0-9]/.test(password);
                
                if (hasLower) strength++;
                if (hasUpper) strength++;
                if (hasNumber) strength++;
                if (hasSpecial) strength++;
                
                // Update bars based on strength
                for (let i = 0; i < strength; i++) {
                    if (i === 0) strengthBars[i].style.backgroundColor = '#ef4444'; // red-500
                    else if (i === 1) strengthBars[i].style.backgroundColor = '#f59e0b'; // amber-500
                    else if (i === 2) strengthBars[i].style.backgroundColor = '#3b82f6'; // blue-500
                    else if (i === 3) strengthBars[i].style.backgroundColor = '#10b981'; // emerald-500
                }
                
                // Update feedback
                if (strength === 1) {
                    feedback.textContent = 'Weak - try adding uppercase letters, numbers, or symbols';
                    feedback.className = 'text-xs text-red-500';
                } else if (strength === 2) {
                    feedback.textContent = 'Moderate - good start but could be stronger';
                    feedback.className = 'text-xs text-amber-500';
                } else if (strength === 3) {
                    feedback.textContent = 'Strong - almost there!';
                    feedback.className = 'text-xs text-blue-500';
                } else if (strength === 4) {
                    feedback.textContent = 'Very strong - great password!';
                    feedback.className = 'text-xs text-emerald-500';
                }
            });

            // Real-time validation for username
            const usernameInput = document.getElementById('username');
            const usernameFeedback = document.getElementById('username-feedback');
            
            usernameInput.addEventListener('input', function() {
                const username = this.value;
                
                if (username.length === 0) {
                    usernameFeedback.textContent = '';
                    return;
                }
                
                if (username.length < 3) {
                    usernameFeedback.textContent = 'Username must be at least 3 characters';
                    usernameFeedback.className = 'text-xs mt-1 text-red-500';
                } else if (!/^[a-zA-Z0-9]+$/.test(username)) {
                    usernameFeedback.textContent = 'Only letters and numbers allowed';
                    usernameFeedback.className = 'text-xs mt-1 text-red-500';
                } else {
                    usernameFeedback.textContent = 'Username is available';
                    usernameFeedback.className = 'text-xs mt-1 text-green-500';
                }
            });

            // Real-time validation for email
            const emailInput = document.getElementById('email');
            const emailFeedback = document.getElementById('email-feedback');
            
            emailInput.addEventListener('input', function() {
                const email = this.value;
                
                if (email.length === 0) {
                    emailFeedback.textContent = '';
                    return;
                }
                
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    emailFeedback.textContent = 'Please enter a valid email address';
                    emailFeedback.className = 'text-xs mt-1 text-red-500';
                } else {
                    emailFeedback.textContent = 'Email format is valid';
                    emailFeedback.className = 'text-xs mt-1 text-green-500';
                }
            });

            // Form submission handler
            const form = document.getElementById('registerForm');
            const submitBtn = document.getElementById('submitBtn');
            
            form.addEventListener('submit', function(e) {
                // Disable button to prevent multiple submissions
                submitBtn.disabled = true;
                submitBtn.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Processing...
                `;
                
                // Form is valid, allow submission
                return true;
            });

            // Additional field validation can be added here as needed
        });
    
    // Terms and Conditions Modal
    const termsLink = document.getElementById('termsLink');
    const termsModal = document.getElementById('termsModal');
    const closeTerms = document.getElementById('closeTerms');
    
    termsLink.addEventListener('click', function(e) {
        e.preventDefault();
        termsModal.classList.remove('hidden');
    });
    
    closeTerms.addEventListener('click', function() {
        termsModal.classList.add('hidden');
    });
    
    window.addEventListener('click', function(event) {
        if (event.target === termsModal) {
            termsModal.classList.add('hidden');
        }
    });
</script>
</body>
</html>